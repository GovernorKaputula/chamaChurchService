<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Church Service RSVP | Kenneth & Natasha</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
    <h1 data-scroll>Church Thanksgiving Service</h1>
    <p data-scroll>Join us as we thank God for His goodness and celebrate His blessings.</p>
  </header>

  <section id="countdown-section" data-scroll>
    <h2>Countdown to the Service</h2>
    <div id="countdown">
      <div><span id="days">00</span><small>Days</small></div>
      <div><span id="hours">00</span><small>Hours</small></div>
      <div><span id="minutes">00</span><small>Minutes</small></div>
      <div><span id="seconds">00</span><small>Seconds</small></div>
    </div>
  </section>

  <section id="details" data-scroll>
    <h2>Service Details</h2>
    <p><strong>Date:</strong> Saturday, 29th November 2025</p>
    <p><strong>Time:</strong> 10:00 AM</p>
    <p><strong>Venue:</strong> Miracle Life Family Church, Lusaka</p>
    <p><strong>Contact:</strong> Chaile Phiri - <a href="tel:+260977326180">+260 977 326180</a></p>
    <p><strong>Organizer:</strong> Bertha Pandwe</p>
  </section>

  <section id="rsvp" data-scroll>
    <h2>RSVP to Attend</h2>
    <form id="rsvp-form">
      <div class="form-group">
        <label for="name">Full Name</label>
        <input type="text" id="name" name="name" placeholder="Enter your name" required />
      </div>

      <div class="form-group">
        <label for="attending">Will you be attending?</label>
        <select id="attending" name="attending" required>
          <option value="">-- Please choose --</option>
          <option value="Yes">Yes, I’ll be there</option>
          <option value="No">No, I can’t make it</option>
        </select>
      </div>

      <div class="form-group">
        <label for="guests">Total number of people (including you)</label>
        <input type="number" id="guests" name="guests" min="1" value="1" required />
      </div>

      <div class="form-group">
        <label for="message">Any message or note (optional)</label>
        <textarea id="message" name="message" rows="3" placeholder="Add a short message"></textarea>
      </div>

      <button type="submit" id="rsvp-submit-button">Submit RSVP</button>
      <div id="rsvp-message"></div>
    </form>
  </section>

  <footer>
    <p>Made with ❤️ by Kenneth & Natasha</p>
  </footer>

  <script>
  document.addEventListener("DOMContentLoaded", function() {
    // === 1. SCROLL REVEAL ===
    const scrollElements = document.querySelectorAll("[data-scroll]");
    const observer = new IntersectionObserver((entries, observer) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add("scrolled");
          observer.unobserve(entry.target);
        }
      });
    }, { threshold: 0.15 });
    scrollElements.forEach(el => observer.observe(el));

    // === 2. COUNTDOWN TIMER ===
    const countdownContainer = document.getElementById("countdown-section");
    const countdownDate = new Date("Nov 29, 2025 10:00:00 GMT+02:00").getTime();

    const timer = setInterval(() => {
      const now = new Date().getTime();
      const distance = countdownDate - now;

      if (distance <= 0) {
        clearInterval(timer);
        countdownContainer.innerHTML = "<h2>The celebration is underway!</h2>";
        return;
      }

      const days = Math.floor(distance / (1000 * 60 * 60 * 24));
      const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((distance % (1000 * 60)) / 1000);

      document.getElementById("days").textContent = days.toString().padStart(2, '0');
      document.getElementById("hours").textContent = hours.toString().padStart(2, '0');
      document.getElementById("minutes").textContent = minutes.toString().padStart(2, '0');
      document.getElementById("seconds").textContent = seconds.toString().padStart(2, '0');
    }, 1000);

    // === 3. GOOGLE SHEETS CHURCH SERVICE RSVP SUBMISSION ===
    const form = document.getElementById('rsvp-form');
    const messageDiv = document.getElementById('rsvp-message');
    const scriptURL = "https://script.google.com/macros/s/AKfycbzfJons21AVtlMPhNeZBHRTIWtO5aIgbKjNQTJOr-ATvnPeKXsyzSq9RWsIvvh3pegf/exec";

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const attendingStatusValue = document.getElementById('attending').value.trim();
      if (!attendingStatusValue) {
        messageDiv.textContent = "⚠️ Please select whether you will attend.";
        messageDiv.style.display = 'block';
        return;
      }

      const data = {
        name: document.getElementById('name').value.trim(),
        attending: attendingStatusValue,
        guests: document.getElementById('guests').value.trim(),
        message: document.getElementById('message').value.trim() || "None"
      };

      messageDiv.textContent = "⏳ Submitting your RSVP...";
      messageDiv.style.display = 'block';
      document.getElementById('rsvp-submit-button').disabled = true;

      try {
        const res = await fetch(scriptURL, {
          method: "POST",
          redirect: "follow",
          headers: { "Content-Type": "text/plain;charset=utf-8" },
          body: JSON.stringify(data)
        });

        if (res.ok) {
          messageDiv.textContent = "✅ Thank you! Your church service RSVP has been received.";
          form.reset();
        } else {
          messageDiv.textContent = "⚠️ There was an issue submitting your RSVP. Please try again later.";
          console.error("Server error:", res.status);
        }
      } catch (err) {
        messageDiv.textContent = "❌ Network error. Please check your connection and try again.";
        console.error("Fetch Error:", err);
      } finally {
        document.getElementById('rsvp-submit-button').disabled = false;
      }
    });
  });
  </script>
</body>
</html>
